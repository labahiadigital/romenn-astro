---
// Static Header - Pure CSS navigation to eliminate CLS from React hydration
// Only the mobile menu will use client-side JavaScript

interface Props {
  currentPath?: string;
}

const { currentPath = "/" } = Astro.props;
const isHome = currentPath === "/";

// Navigation structure
const navItems = [
  {
    label: "La Firma",
    items: [
      { href: "/experiencia", title: "Experiencia Römenn", desc: "Descubra nuestra metodología única y el mapa emocional de Rivas." },
      { href: "/manifiesto", title: "Manifiesto", desc: "Nuestra declaración de intenciones y valores." },
      { href: "/compromiso", title: "Nuestro Compromiso", desc: "Un pacto de honor con cada cliente." },
      { href: "/nosotros", title: "Quiénes Somos", desc: "Conozca al equipo boutique detrás de la marca." },
    ]
  },
  {
    label: "Servicios",
    items: [
      { href: "/servicios", title: "Servicios 360°", desc: "Ecosistema completo: Jurídico, Financiero, Reformas..." },
      { href: "/estudio-financiero", title: "Estudio Financiero", desc: "Análisis gratuito de su capacidad de inversión." },
      { href: "/cronogramas", title: "Blueprints", desc: "Cronogramas animados de su operación." },
      { href: "/riesgos-ocultos", title: "Riesgos Ocultos", desc: "Lo que nadie le cuenta del mercado." },
      { href: "/metodologia", title: "Metodología", desc: "Ciencia de datos aplicada a la venta." },
    ]
  },
  {
    label: "Propiedades",
    items: [
      { href: "/propiedades", title: "Portfolio Exclusivo", desc: "Selección curada de hogares con alma." },
      { href: "/vender", title: "Vende con nosotros", desc: "Maximice el valor de su patrimonio." },
      { href: "/compradores", title: "Personal Shopper", desc: "Encontramos lo que no está en portales." },
      { href: "/valoracion", title: "Valoración", desc: "Tasación inteligente y emocional." },
    ]
  },
  {
    label: "Comunidad",
    items: [
      { href: "/boca-boca", title: "Club de Embajadores", desc: "Programa de referidos exclusivo." },
      { href: "/resenas", title: "Experiencias", desc: "Lo que dicen nuestros clientes." },
      { href: "/casos-reales", title: "Historias Reales", desc: "Documentales de éxito inmobiliario." },
      { href: "/blog", title: "Journal", desc: "Tendencias y noticias del sector." },
    ]
  }
];
---

<header 
  id="main-header"
  class:list={[
    "fixed top-0 left-0 right-0 z-50 transition-all duration-500",
    isHome ? "header-transparent" : "header-solid"
  ]}
  data-home={isHome ? "true" : "false"}
>
  <div class="max-w-7xl mx-auto px-6">
    <div class="flex items-center justify-between h-24">
      <!-- Logo -->
      <a href="/" class="flex items-center gap-3 group">
        <img 
          src="/romenn-logo.svg" 
          alt="Römenn Logo" 
          width="96"
          height="96"
          fetchpriority="high"
          class="header-logo h-24 w-auto object-contain transition-all duration-500 brightness-0"
        />
      </a>

      <!-- Navigation Desktop - Pure CSS dropdowns -->
      <nav class="hidden xl:flex items-center gap-2" aria-label="Navegación principal">
        <a href="/" class="nav-link">Inicio</a>
        
        {navItems.map((nav) => (
          <div class="nav-dropdown-container relative">
            <button class="nav-link nav-trigger" aria-expanded="false">
              {nav.label}
              <svg class="w-3 h-3 ml-1 transition-transform" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="m6 9 6 6 6-6"/>
              </svg>
            </button>
            <div class="nav-dropdown">
              <ul class="nav-dropdown-list">
                {nav.items.map((item) => (
                  <li>
                    <a href={item.href} class="nav-dropdown-item">
                      <span class="text-sm font-semibold">{item.title}</span>
                      <span class="text-xs text-muted-foreground font-light">{item.desc}</span>
                    </a>
                  </li>
                ))}
              </ul>
            </div>
          </div>
        ))}
      </nav>

      <!-- Right side - Contact -->
      <div class="hidden lg:flex items-center gap-6">
        <a href="tel:+34747488562" class="header-phone flex items-center gap-2 text-xs tracking-widest transition-colors font-bold">
          <svg class="w-3 h-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
          </svg>
          <span>747 488 562</span>
        </a>
        <a href="/contacto" class="header-cta rounded-none h-10 px-6 transition-all duration-500 inline-flex items-center justify-center text-xs font-bold uppercase tracking-widest">
          Contacto
        </a>
      </div>

      <!-- Mobile Menu Button -->
      <button 
        id="mobile-menu-btn"
        class="xl:hidden p-2 transition-colors rounded-md mobile-menu-btn"
        aria-label="Abrir menú"
        aria-expanded="false"
      >
        <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="4" x2="20" y1="12" y2="12"/>
          <line x1="4" x2="20" y1="6" y2="6"/>
          <line x1="4" x2="20" y1="18" y2="18"/>
        </svg>
      </button>
    </div>
  </div>
</header>

<!-- Mobile Menu Overlay -->
<div id="mobile-menu" class="mobile-menu-overlay" aria-hidden="true">
  <div class="mobile-menu-panel">
    <div class="p-6 border-b border-border/50">
      <div class="flex items-center justify-between">
        <img src="/romenn-logo.svg" alt="Römenn" width="64" height="64" class="h-16 w-auto object-contain" />
        <button id="mobile-menu-close" class="p-2 hover:bg-muted rounded-md" aria-label="Cerrar menú">
          <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 6 6 18"/><path d="m6 6 12 12"/>
          </svg>
        </button>
      </div>
      <p class="text-xs tracking-widest uppercase text-muted-foreground mt-4">
        Inmobiliaria Boutique Internacional
      </p>
    </div>
    
    <nav class="p-6 overflow-y-auto flex-1">
      <a href="/" class="block text-sm font-bold uppercase tracking-widest hover:text-accent transition-colors py-3 border-b border-border/30">
        Inicio
      </a>
      
      {navItems.map((nav, idx) => (
        <details class="mobile-accordion border-b border-border/30">
          <summary class="text-sm font-bold uppercase tracking-widest py-4 cursor-pointer hover:text-accent transition-colors flex items-center justify-between">
            {nav.label}
            <svg class="w-4 h-4 transition-transform accordion-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="m6 9 6 6 6-6"/>
            </svg>
          </summary>
          <div class="pl-4 pb-4 flex flex-col gap-1">
            {nav.items.map((item) => (
              <a href={item.href} class="text-sm font-serif text-muted-foreground hover:text-primary transition-colors py-3 block">
                {item.title}
              </a>
            ))}
          </div>
        </details>
      ))}
      
      <div class="mt-8 space-y-6">
        <a href="tel:+34747488562" class="flex items-center gap-3 text-xs tracking-widest hover:text-accent transition-colors font-bold text-primary">
          <div class="w-8 h-8 rounded-full border border-primary/20 flex items-center justify-center">
            <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
            </svg>
          </div>
          <span>747 488 562</span>
        </a>
        <a href="/contacto" class="btn-premium w-full h-14 text-xs inline-flex items-center justify-center">
          Contacto
        </a>
      </div>
    </nav>
  </div>
</div>

<style>
  /* Header states */
  .header-transparent {
    background: transparent;
    border-color: transparent;
    padding-top: 1rem;
  }
  .header-transparent .header-logo {
    filter: brightness(0) invert(1);
  }
  .header-transparent .nav-link {
    color: white;
  }
  .header-transparent .nav-link:hover {
    background: rgba(255,255,255,0.1);
  }
  .header-transparent .header-phone {
    color: white;
  }
  .header-transparent .header-phone:hover {
    color: rgba(255,255,255,0.8);
  }
  .header-transparent .header-cta {
    background: white;
    color: hsl(224 35% 11%);
  }
  .header-transparent .header-cta:hover {
    background: rgba(255,255,255,0.9);
    box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
  }
  .header-transparent .mobile-menu-btn {
    color: white;
  }
  .header-transparent .mobile-menu-btn:hover {
    background: rgba(255,255,255,0.1);
  }

  .header-solid {
    background: rgba(255,255,255,0.8);
    backdrop-filter: blur(12px);
    border-bottom: 1px solid hsl(220 13% 91% / 0.5);
    box-shadow: 0 1px 2px 0 rgba(0,0,0,0.05);
  }
  .header-solid .header-logo {
    filter: brightness(0);
  }
  .header-solid .nav-link {
    color: hsl(224 35% 11%);
  }
  .header-solid .nav-link:hover {
    background: hsl(217 75% 45% / 0.1);
    color: hsl(217 75% 45%);
  }
  .header-solid .header-phone {
    color: hsl(224 35% 11%);
  }
  .header-solid .header-phone:hover {
    color: hsl(217 75% 45%);
  }
  .header-solid .header-cta {
    position: relative;
    overflow: hidden;
    background: hsl(224 35% 11%);
    color: white;
    border: 1px solid transparent;
  }
  .header-solid .header-cta:hover {
    background: hsl(217 75% 45%);
    box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
  }
  .header-solid .mobile-menu-btn:hover {
    background: hsl(224 20% 94%);
  }

  /* Navigation links */
  .nav-link {
    display: inline-flex;
    align-items: center;
    height: 40px;
    padding: 0 1rem;
    font-size: 0.75rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    border-radius: 0.375rem;
    transition: all 0.15s;
  }

  /* Dropdown */
  .nav-dropdown-container {
    position: relative;
  }
  .nav-dropdown {
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%) scale(0.95);
    opacity: 0;
    visibility: hidden;
    background: white;
    border-radius: 0.5rem;
    box-shadow: 0 10px 40px rgba(0,0,0,0.15);
    transition: all 0.2s ease;
    margin-top: 0.5rem;
    z-index: 100;
  }
  .nav-dropdown-container:hover .nav-dropdown,
  .nav-dropdown-container:focus-within .nav-dropdown {
    opacity: 1;
    visibility: visible;
    transform: translateX(-50%) scale(1);
  }
  .nav-dropdown-container:hover .nav-trigger svg,
  .nav-dropdown-container:focus-within .nav-trigger svg {
    transform: rotate(180deg);
  }
  .nav-dropdown-item {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    padding: 0.75rem 1rem;
    border-radius: 0.375rem;
    transition: all 0.15s;
  }
  .nav-dropdown-item:hover {
    background: hsl(217 75% 45%);
    color: white;
  }
  .nav-dropdown-item:hover .text-muted-foreground {
    color: rgba(255,255,255,0.9);
  }
  .nav-dropdown-list {
    display: grid;
    gap: 0.5rem;
    padding: 1rem;
    width: 300px;
    min-width: 300px;
  }

  /* Mobile menu */
  .mobile-menu-overlay {
    position: fixed;
    inset: 0;
    z-index: 100;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s;
  }
  .mobile-menu-overlay.open {
    opacity: 1;
    visibility: visible;
  }
  .mobile-menu-overlay::before {
    content: '';
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.5);
  }
  .mobile-menu-panel {
    position: absolute;
    right: 0;
    top: 0;
    bottom: 0;
    width: 300px;
    max-width: 100%;
    background: rgba(255,255,255,0.95);
    backdrop-filter: blur(20px);
    transform: translateX(100%);
    transition: transform 0.3s ease;
    display: flex;
    flex-direction: column;
  }
  .mobile-menu-overlay.open .mobile-menu-panel {
    transform: translateX(0);
  }

  /* Mobile accordion */
  .mobile-accordion summary::-webkit-details-marker {
    display: none;
  }
  .mobile-accordion[open] .accordion-icon {
    transform: rotate(180deg);
  }
</style>

<script is:inline>
  // Minimal script for scroll behavior and mobile menu
  (function() {
    var header = document.getElementById('main-header');
    var isHome = header && header.dataset.home === 'true';
    
    if (isHome && header) {
      var ticking = false;
      var handleScroll = function() {
        if (!ticking) {
          requestAnimationFrame(function() {
            var scrolled = window.scrollY > 50;
            if (scrolled) {
              header.classList.remove('header-transparent');
              header.classList.add('header-solid');
            } else {
              header.classList.remove('header-solid');
              header.classList.add('header-transparent');
            }
            ticking = false;
          });
          ticking = true;
        }
      };
      window.addEventListener('scroll', handleScroll, { passive: true });
    }

    // Mobile menu
    var mobileMenuBtn = document.getElementById('mobile-menu-btn');
    var mobileMenu = document.getElementById('mobile-menu');
    var mobileMenuClose = document.getElementById('mobile-menu-close');

    if (mobileMenuBtn) {
      mobileMenuBtn.addEventListener('click', function() {
        if (mobileMenu) {
          mobileMenu.classList.add('open');
          mobileMenu.setAttribute('aria-hidden', 'false');
          document.body.style.overflow = 'hidden';
        }
      });
    }

    var closeMenu = function() {
      if (mobileMenu) {
        mobileMenu.classList.remove('open');
        mobileMenu.setAttribute('aria-hidden', 'true');
        document.body.style.overflow = '';
      }
    };

    if (mobileMenuClose) {
      mobileMenuClose.addEventListener('click', closeMenu);
    }
    
    if (mobileMenu) {
      mobileMenu.addEventListener('click', function(e) {
        if (e.target === mobileMenu) closeMenu();
      });
    }
  })();
</script>
